---

title: Data Provider


keywords: fastai
sidebar: home_sidebar

summary: "This module is responsible for processing raw TRR data for further analysis. ToDo: This code should be formatted as a class that gets the data folder path on init."
description: "This module is responsible for processing raw TRR data for further analysis. ToDo: This code should be formatted as a class that gets the data folder path on init."
nb_path: "notebooks/01_data_provider.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/01_data_provider.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DataProvider" class="doc_header"><code>class</code> <code>DataProvider</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L13" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DataProvider</code>(<strong><code>data_folder_path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_efficiently" class="doc_header"><code>get_efficiently</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_efficiently</code>(<strong><code>func</code></strong>)</p>
</blockquote>
<p>This decorator wraps around functions that get data and handles data storage.
If the output from the function hasn't been stored yet, it stores it in "[path_to_interim]/[function_name_without_get].parquet"
If the output from the function has been stored already, it loads the stored file instead of running the function (unless update is specified as True)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dp</span> <span class="o">=</span> <span class="n">DataProvider</span><span class="p">(</span><span class="s1">&#39;/Users/hilmarzech/Projects/trr265/trr265/data/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions">Functions<a class="anchor-link" href="#Functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.store_interim" class="doc_header"><code>DataProvider.store_interim</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.store_interim</code>(<strong><code>df</code></strong>, <strong><code>filename</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.load_interim" class="doc_header"><code>DataProvider.load_interim</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.load_interim</code>(<strong><code>filename</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">storing_test</span><span class="p">(</span><span class="n">dp</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;test&quot;</span><span class="p">:[</span><span class="mi">4</span><span class="p">]})</span>
    <span class="c1"># Storing the dataframe</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">store_interim</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;storing_test&#39;</span><span class="p">)</span>
    <span class="c1"># Reloading it and comparing to original</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">load_interim</span><span class="p">(</span><span class="s1">&#39;storing_test&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">storing_test</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="s2">&quot;Data storage is failing.&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-phone-screening-data">Getting phone screening data<a class="anchor-link" href="#Getting-phone-screening-data"> </a></h3><blockquote><p>This functions get the phone screening data from redcap.  To run them, first go to redcap and download the phonescreening data to 'raw/phonescreening.csv' and the phonescreening codebook to 'external/phone_codebook.html'.  You also need the external/b7_participants.xlsx (if it's not in the cloned package, ask Hilmar for it.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_phone_codebook" class="doc_header"><code>DataProvider.get_phone_codebook</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L78" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_phone_codebook</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="s1">&#39;participant_id&#39;</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_phone_codebook</span><span class="p">()</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Failed to load phone_codebook.html&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Initially, participants from b07 were stored in the same RedCap project as S01 participants.  This function attempts to disentangle the two</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.determine_phone_b07" class="doc_header"><code>DataProvider.determine_phone_b07</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L105" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.determine_phone_b07</code>(<strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.check_participant_id" class="doc_header"><code>DataProvider.check_participant_id</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L142" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.check_participant_id</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>This function checks whether a participant ID is numerical and lower than 20000.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.test_check_participant_id" class="doc_header"><code>DataProvider.test_check_participant_id</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L155" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.test_check_participant_id</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">dp</span><span class="o">.</span><span class="n">test_check_participant_id</span><span class="p">(),</span> <span class="s2">&quot;Participant ID check is not working&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.set_dtypes" class="doc_header"><code>DataProvider.set_dtypes</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.set_dtypes</code>(<strong><code>data</code></strong>, <strong><code>codebook</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_phone_data" class="doc_header"><code>DataProvider.get_phone_data</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L213" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_phone_data</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="s1">&#39;screen_caller&#39;</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_phone_data</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;Failed to load phone data.&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-baseline-data">Getting baseline data<a class="anchor-link" href="#Getting-baseline-data"> </a></h3><p>{% include warning.html content='This function does not work if the computers default encoding is not UTF-8 -&gt; This should be adjusted in pd.readhtml...' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_ba_codebook" class="doc_header"><code>DataProvider.get_ba_codebook</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L238" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_ba_codebook</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="s1">&#39;variable&#39;</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_ba_codebook</span><span class="p">(),</span> <span class="s2">&quot;Codebook did not load correctly&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include warning.html content='get_ba_data uses a different way to remove b07 participants.  This should be adjusted to use the same function as get_phone_data' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_ba_data" class="doc_header"><code>DataProvider.get_ba_data</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L265" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_ba_data</code>()</p>
</blockquote>
<p>This function reads in baseline data from redcap, filters out pilot data, and creates movisens IDs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>ToDo:This should be defined as a "slow test"</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">check_ba</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_ba_data</span><span class="p">()[[</span><span class="s1">&#39;participant_id&#39;</span><span class="p">,</span><span class="s1">&#39;redcap_event_name&#39;</span><span class="p">,</span><span class="s1">&#39;redcap_repeat_instrument&#39;</span><span class="p">,</span><span class="s1">&#39;redcap_repeat_instance&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">check_ba</span><span class="p">,</span> <span class="s2">&quot;Redcap BA data was not properly formatted&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dp</span><span class="o">.</span><span class="n">get_ba_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant_id</th>
      <th>redcap_event_name</th>
      <th>redcap_repeat_instrument</th>
      <th>redcap_repeat_instance</th>
      <th>redcap_survey_identifier</th>
      <th>bx_pams</th>
      <th>bx_exist120</th>
      <th>study_id</th>
      <th>bx_date</th>
      <th>languages</th>
      <th>...</th>
      <th>bx_anruf_o2</th>
      <th>bx_anruf_o2txt</th>
      <th>bx_anruf_o3</th>
      <th>anrufprotokoll_complete</th>
      <th>center</th>
      <th>mov_id</th>
      <th>mov_id_old</th>
      <th>mov_id_old_2</th>
      <th>is_b07</th>
      <th>is_female</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>53</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10101.0</td>
      <td>2021-10-20</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>53</td>
      <td>mrterhebung_1_arm_1</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>53</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>at_home_qsu</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>53</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>at_home_ftnd</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>53</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>at_home_bis15</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>b</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15010</th>
      <td>12205</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10101.0</td>
      <td>2022-01-17</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>m</td>
      <td>m282</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15011</th>
      <td>12205</td>
      <td>mrterhebung_1_arm_1</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>m</td>
      <td>m282</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15012</th>
      <td>12205</td>
      <td>mrterhebung_1_arm_1</td>
      <td>neuerfb</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>m</td>
      <td>m282</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15013</th>
      <td>12205</td>
      <td>mrterhebung_1_arm_1</td>
      <td>clinic_participant_panas</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>m</td>
      <td>m282</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15014</th>
      <td>12205</td>
      <td>mrterhebung_1_arm_1</td>
      <td>clinic_examiner_mrt_examination</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>m</td>
      <td>m282</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>15015 rows × 3918 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-standard-drinks-per-day-in-last-three-months-before-baseline">Getting standard drinks per day in last three months before baseline<a class="anchor-link" href="#Getting-standard-drinks-per-day-in-last-three-months-before-baseline"> </a></h3><p>Used variables:</p>
<ul>
<li>An wie vielen Tagen tranken Sie in den letzten 3 Monaten zumindest 1 Glas Alkohol? (bx_qf_alc_01)</li>
<li>Welches Format hatte die Angabe der Tage in der vorhergehenden Frage? (bx_qf_alc_02)<ul>
<li>Angabe in den letzten 3 Monaten. (1)</li>
<li>Angabe pro Woche innerhalb der letzten 3 Monat. (2)</li>
</ul>
</li>
<li>An diesen Tagen an denen Sie in den letzten 3 Monaten Alkohol tranken: Können Sie mir anhand der Abbildungen auf der Liste angeben, was und wie viel Sie üblicherweise an einem Tag tranken?" (bx_qf1_sum)</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ba</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_ba_data</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;participant_id&#39;</span><span class="p">,</span><span class="s1">&#39;redcap_event_name&#39;</span><span class="p">,</span><span class="s1">&#39;mov_id&#39;</span><span class="p">,</span><span class="s1">&#39;bx_qf_alc_01&#39;</span><span class="p">,</span><span class="s1">&#39;bx_qf_alc_02&#39;</span><span class="p">,</span><span class="s1">&#39;bx_qf1_sum&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;redcap_event_name==&#39;erhebungszeitpunkt_arm_1&#39;&quot;</span><span class="p">)</span>
<span class="n">ba</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">ba</span><span class="o">.</span><span class="n">participant_id</span><span class="o">==</span><span class="s1">&#39;11303&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ba</span><span class="o">.</span><span class="n">bx_qf_alc_02</span><span class="o">==</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;bx_qf_alc_02&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ba</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">ba</span><span class="o">.</span><span class="n">participant_id</span><span class="o">==</span><span class="s1">&#39;11303&#39;</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant_id</th>
      <th>redcap_event_name</th>
      <th>mov_id</th>
      <th>bx_qf_alc_01</th>
      <th>bx_qf_alc_02</th>
      <th>bx_qf1_sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11367</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>24.0</td>
      <td>1.0</td>
      <td>3.2</td>
    </tr>
    <tr>
      <th>11373</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11374</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11375</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11376</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11377</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11378</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11379</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11380</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11381</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11382</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11383</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11384</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11385</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11386</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11387</th>
      <td>11303</td>
      <td>erhebungszeitpunkt_arm_1</td>
      <td>m190</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_baseline_drinking_data" class="doc_header"><code>DataProvider.get_baseline_drinking_data</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L301" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_baseline_drinking_data</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dp</span><span class="o">.</span><span class="n">get_baseline_drinking_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>last_three_month</th>
      <th>drinks_per_drinking_day_last_three_month</th>
      <th>drinking_days_last_three_month</th>
    </tr>
    <tr>
      <th>participant</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b000</th>
      <td>5.666667</td>
      <td>8.50</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>b001</th>
      <td>0.800000</td>
      <td>2.00</td>
      <td>36.0</td>
    </tr>
    <tr>
      <th>b002</th>
      <td>1.860000</td>
      <td>4.65</td>
      <td>36.0</td>
    </tr>
    <tr>
      <th>b012</th>
      <td>2.880000</td>
      <td>5.40</td>
      <td>48.0</td>
    </tr>
    <tr>
      <th>b013</th>
      <td>6.300000</td>
      <td>6.75</td>
      <td>84.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>m278</th>
      <td>1.653333</td>
      <td>6.20</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>m279</th>
      <td>1.906667</td>
      <td>7.15</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>m280</th>
      <td>1.240000</td>
      <td>3.10</td>
      <td>36.0</td>
    </tr>
    <tr>
      <th>m281</th>
      <td>4.533333</td>
      <td>8.50</td>
      <td>48.0</td>
    </tr>
    <tr>
      <th>m282</th>
      <td>2.200000</td>
      <td>5.50</td>
      <td>36.0</td>
    </tr>
  </tbody>
</table>
<p>501 rows × 3 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-Movisense-data">Getting Movisense data<a class="anchor-link" href="#Getting-Movisense-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_duplicate_mov_ids" class="doc_header"><code>DataProvider.get_duplicate_mov_ids</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L316" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_duplicate_mov_ids</code>()</p>
</blockquote>
<p>This function creates a dictionary mapping old to new movisens IDs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">get_duplicate_mov_ids</span><span class="p">()),</span> <span class="s2">&quot;Could not load duplicate_mov_ids&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_mov_data" class="doc_header"><code>DataProvider.get_mov_data</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L332" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_mov_data</code>()</p>
</blockquote>
<p>This function gets Movisense data
1) We create unique participnat IDs (e.g. "b001"; this is necessary as sites use overapping IDs)
2) We merge double IDs, so participants with two IDs only have one (for this duplicate_ids.csv has to be updated)
3) We remove pilot participants
4) We get starting dates (from the participant overviews in movisense; downloaded as html)
5) We calculate sampling days and end dates based on the starting dates</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include warning.html content='Note that some participants do not have associated redcap data (see below).  These participants are excluded from further data analyses.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_mov_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Preparing mov_data
Participants: b186, d092, m158 have no associated redcap IDs and are excluded from the following analyses.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Structure-of-movisense-data-(selected-columns)">Structure of movisense data (selected columns)<a class="anchor-link" href="#Structure-of-movisense-data-(selected-columns)"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dp</span><span class="o">.</span><span class="n">get_mov_data</span><span class="p">()[[</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;starting_date&#39;</span><span class="p">,</span><span class="s1">&#39;Trigger&#39;</span><span class="p">,</span><span class="s1">&#39;Trigger_date&#39;</span><span class="p">,</span><span class="s1">&#39;Trigger_counter&#39;</span><span class="p">,</span><span class="s1">&#39;Form&#39;</span><span class="p">,</span><span class="s1">&#39;INT_Coverage_kleinesBier&#39;</span><span class="p">,</span><span class="s1">&#39;INT_Coverage_kleinerWeisswein&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant</th>
      <th>starting_date</th>
      <th>Trigger</th>
      <th>Trigger_date</th>
      <th>Trigger_counter</th>
      <th>Form</th>
      <th>INT_Coverage_kleinesBier</th>
      <th>INT_Coverage_kleinerWeisswein</th>
    </tr>
    <tr>
      <th>mov_index</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>b001</td>
      <td>2020-02-24</td>
      <td>Button Pressed: Spiele starten und Initialfrag...</td>
      <td>2020-02-24</td>
      <td>9</td>
      <td>Tag 1 Info</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>b001</td>
      <td>2020-02-24</td>
      <td>Fixed Time: 09:00</td>
      <td>2020-02-24</td>
      <td>11</td>
      <td>Missing</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>b001</td>
      <td>2020-02-24</td>
      <td>Fixed Time: 12:00</td>
      <td>2020-02-24</td>
      <td>17</td>
      <td>Coverage</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>b001</td>
      <td>2020-02-24</td>
      <td>Fixed Time: 12:00</td>
      <td>2020-02-24</td>
      <td>17</td>
      <td>Craving</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>b001</td>
      <td>2020-02-24</td>
      <td>Fixed Time: 12:00</td>
      <td>2020-02-24</td>
      <td>17</td>
      <td>MDBF</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>200030</th>
      <td>m235</td>
      <td>2021-05-17</td>
      <td>Button Pressed: Spiele starten und Initialfrag...</td>
      <td>2021-08-16</td>
      <td>16</td>
      <td>Tag 1 Info</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>200031</th>
      <td>m235</td>
      <td>2021-05-17</td>
      <td>Button Pressed: Spiele starten und Initialfrag...</td>
      <td>2021-08-16</td>
      <td>16</td>
      <td>Initial</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>200032</th>
      <td>m235</td>
      <td>2021-05-17</td>
      <td>Button Pressed: Spiele starten und Initialfrag...</td>
      <td>2021-08-16</td>
      <td>16</td>
      <td>GBE_Tag1_Vorher</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>200033</th>
      <td>m235</td>
      <td>2021-05-17</td>
      <td>Button Pressed: Spiele starten und Initialfrag...</td>
      <td>2021-08-16</td>
      <td>16</td>
      <td>GreatBrainExperiment</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>200034</th>
      <td>m235</td>
      <td>2021-05-17</td>
      <td>Button Pressed: Spiele starten und Initialfrag...</td>
      <td>2021-08-16</td>
      <td>16</td>
      <td>GreatBrainExperiment</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>199456 rows × 8 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-two-day-data">Getting two-day data<a class="anchor-link" href="#Getting-two-day-data"> </a></h3><p>This is a subset of the movisense data (only the two-daily questions), which we reformat so that each day is one one line.  We also add nan data for dates after the last data was received until 365 days until the starting date.  We rearrange answers to retrospective questions, so they are associated with the date in question rather than the date on which the question was answered.  For example, the answer to the question "How many beers did you drink two days ago" gets shifted two days back from the date of the question.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_alcohol_per_drink" class="doc_header"><code>DataProvider.get_alcohol_per_drink</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L407" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_alcohol_per_drink</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">get_alcohol_per_drink</span><span class="p">())</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()),</span> <span class="s2">&quot;Could not load &#39;alcohol_per_drink.csv&#39; from external data&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>We use this conversion table to convert participants' answers into ml_alc</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dp</span><span class="o">.</span><span class="n">get_alcohol_per_drink</span><span class="p">()[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span><span class="s1">&#39;vol&#39;</span><span class="p">,</span><span class="s1">&#39;ml_alc_per_drink&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>amount</th>
      <th>unit</th>
      <th>vol</th>
      <th>ml_alc_per_drink</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Kleines Bier</td>
      <td>0.20</td>
      <td>Liter</td>
      <td>5.0</td>
      <td>10.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mittleres Bier</td>
      <td>0.33</td>
      <td>Liter</td>
      <td>5.0</td>
      <td>16.50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Großes Bier</td>
      <td>0.50</td>
      <td>Liter</td>
      <td>5.0</td>
      <td>25.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Kleiner Weißwein</td>
      <td>0.10</td>
      <td>Liter</td>
      <td>11.0</td>
      <td>11.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mittlerer Weißwein</td>
      <td>0.20</td>
      <td>Liter</td>
      <td>11.0</td>
      <td>22.00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Flasche Weißwein</td>
      <td>0.75</td>
      <td>Liter</td>
      <td>11.0</td>
      <td>82.50</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Kleiner Rotwein</td>
      <td>0.10</td>
      <td>Liter</td>
      <td>12.0</td>
      <td>12.00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Mittlerer Rotwein</td>
      <td>0.20</td>
      <td>Liter</td>
      <td>12.0</td>
      <td>24.00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Flasche Rotwein</td>
      <td>0.75</td>
      <td>Liter</td>
      <td>12.0</td>
      <td>90.00</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Sekt</td>
      <td>0.10</td>
      <td>Liter</td>
      <td>11.5</td>
      <td>11.50</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Flasche Sekt</td>
      <td>0.75</td>
      <td>Liter</td>
      <td>11.5</td>
      <td>86.25</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Likör-Wein</td>
      <td>5.00</td>
      <td>cl</td>
      <td>19.7</td>
      <td>9.85</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Kleiner Likör</td>
      <td>2.00</td>
      <td>cl</td>
      <td>20.0</td>
      <td>4.00</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Großer Likör</td>
      <td>5.00</td>
      <td>cl</td>
      <td>20.0</td>
      <td>10.00</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Likör süß</td>
      <td>2.00</td>
      <td>cl</td>
      <td>17.0</td>
      <td>3.40</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Kleine Spirituose</td>
      <td>2.00</td>
      <td>cl</td>
      <td>40.0</td>
      <td>8.00</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Große Spirituose</td>
      <td>5.00</td>
      <td>cl</td>
      <td>40.0</td>
      <td>20.00</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Spirituose</td>
      <td>100.00</td>
      <td>ml</td>
      <td>40.0</td>
      <td>40.00</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Kleine Spirituose</td>
      <td>2.00</td>
      <td>cl</td>
      <td>65.0</td>
      <td>13.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataProvider.get_two_day_data" class="doc_header"><code>DataProvider.get_two_day_data</code><a href="https://github.com/hgzech/trr265/tree/master/trr265/data_provider.py#L415" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataProvider.get_two_day_data</code>()</p>
</blockquote>
<p>Gets two-day which are a subset of mov_data
1) We select two-day forms and turn the dataframe into one row per participant-date (Form repetitions on the same day are removed)
2) We reduce all drinking questions to an easily readable dictionary of drink amounts.
3) We add missing data for dates on which we did not receive answers (starting 2 days before starting date up to 365 days after)
4) We shift answers from retrospective drinking questions backwards to the adequate date (e.g. one day back for yesterday questions)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_two_day_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Preparing two_day_data
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_one_line_per_participant_day</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">dp</span><span class="o">.</span><span class="n">get_two_day_data</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">assert</span> <span class="n">test_one_line_per_participant_day</span><span class="p">(),</span> <span class="s2">&quot;Two day data does not have one line per participant day.&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Structure-of-two-day-data">Structure of two-day data<a class="anchor-link" href="#Structure-of-two-day-data"> </a></h4><p>{% include warning.html content='Note that sampling days run further than 365.  This should not be the case.  It turns out that for these participants the end date was manually set further than one year after the start date, on the movisens page.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dp</span><span class="o">.</span><span class="n">get_two_day_data</span><span class="p">()[[</span><span class="s1">&#39;mov_index&#39;</span><span class="p">,</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;starting_date&#39;</span><span class="p">,</span><span class="s1">&#39;sampling_day&#39;</span><span class="p">,</span><span class="s1">&#39;soziale_isolation&#39;</span><span class="p">,</span><span class="s1">&#39;drinks&#39;</span><span class="p">,</span><span class="s1">&#39;g_alc&#39;</span><span class="p">]]</span><span class="c1">#.iloc[:20]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mov_index</th>
      <th>participant</th>
      <th>date</th>
      <th>starting_date</th>
      <th>sampling_day</th>
      <th>soziale_isolation</th>
      <th>drinks</th>
      <th>g_alc</th>
    </tr>
    <tr>
      <th>two_day_index</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>b001</td>
      <td>2020-02-22</td>
      <td>2020-02-24</td>
      <td>1</td>
      <td>NaN</td>
      <td>{'AnzahlFlascheWeisswein': None, 'AnzahlFlasch...</td>
      <td>6.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>b001</td>
      <td>2020-02-23</td>
      <td>2020-02-24</td>
      <td>2</td>
      <td>NaN</td>
      <td>{'AnzahlFlascheWeisswein': 0.0, 'AnzahlFlasche...</td>
      <td>35.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6.0</td>
      <td>b001</td>
      <td>2020-02-24</td>
      <td>2020-02-24</td>
      <td>3</td>
      <td>1.0</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>b001</td>
      <td>2020-02-25</td>
      <td>2020-02-24</td>
      <td>4</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>b001</td>
      <td>2020-02-26</td>
      <td>2020-02-24</td>
      <td>5</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>134247</th>
      <td>NaN</td>
      <td>m271</td>
      <td>2021-12-10</td>
      <td>2020-12-14</td>
      <td>364</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>134248</th>
      <td>NaN</td>
      <td>m271</td>
      <td>2021-12-11</td>
      <td>2020-12-14</td>
      <td>365</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>134249</th>
      <td>NaN</td>
      <td>m271</td>
      <td>2021-12-12</td>
      <td>2020-12-14</td>
      <td>366</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>134250</th>
      <td>NaN</td>
      <td>m271</td>
      <td>2021-12-13</td>
      <td>2020-12-14</td>
      <td>367</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>134251</th>
      <td>NaN</td>
      <td>m271</td>
      <td>2021-12-14</td>
      <td>2020-12-14</td>
      <td>368</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>134252 rows × 8 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

